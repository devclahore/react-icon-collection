const fs = require('fs');
const storyTemplate = require('./story-template');

const generate = () => {
  const iconDir = './assets/';
  const saveDir = './src/__stories__/';
  let iconListOutput = '';
  let level1FileName = '';

  // Read root Logo directory
  fs.readdirSync(iconDir).forEach(fileName => {
    if (fileName === '.DS_Store') return;

    const level1Dir = `${iconDir}${fileName}`;

    iconListOutput = `/**
 * Generated by scripts/generate-icons.js
 * DO NOT EDIT!
 */
        
import * as Icons from '../${fileName}';

export const ICON_LIST = [
`;
    // Read level1-directory
    fs.readdirSync(level1Dir).forEach(_level1FileName => {
      if (_level1FileName === '.DS_Store') return;

      level1FileName = _level1FileName;
      
      iconListOutput += `  { icon: Icons.${level1FileName.split('.')[0]}, name: '${level1FileName.split('.')[0]}' },
`;
    });
    iconListOutput += `];
`;
    const categoryName = fileName.split('-').map(str => str[0].toUpperCase() + str.slice(1)).join('');
    const story = storyTemplate(categoryName, fileName);
    fs.writeFileSync(`${saveDir}/${fileName}.ts`, iconListOutput);
    fs.writeFileSync(`${saveDir}/${fileName}.story.tsx`, story);
  });
};

generate();
